<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- dao 작성 -->
<!-- namespace : implememts와 같은 기능 -->
<mapper namespace="ks47team03.admin.mapper.AdminCommonMapper">

	<select id="getadminIdList" resultType="User">
	/*관리자 아이디 조회*/
		SELECT
		 	um.user_id AS userId
		FROM
		 	user_manage AS um
		WHERE
			left(um.user_id,5) ='admin';
	
	</select>
	
 	 <select id="getUserList" parameterType="map" resultType="map">
		/* 회원목록 조회 */
		SELECT
			u.user_id				AS userId,
			u.user_pw				AS userPw,
			u.user_name			AS userName,
			u.user_level			AS userLevel,
			u.user_Idcard_number	AS userIdcardnumber,
			u.user_addr			AS userAddr,
			u.user_email			AS userEmail,
			u.user_phone			AS userPhone,
			u.user_nick			AS userNick,
			u.user_sms_check		AS userSmscheck,
			u.user_email_check	AS userEmailcheck,
			u.static_code			AS staticCode,
			cast(u.user_join_datetime AS CHAR(20))	AS userJoindatetime
		FROM 
			user_manage as u
		<where>
        	<if test="searchValue != null and s
rchValue !=''">
        		${searchKey} = #{searchValue}
        	</if>
        </where>
		<if test="startIndex != null and startIndex > -1 ">
			LIMIT #{startIndex},#{rowPerPage};
		</if>
	</select> 
	<select id="getUserListCount" parameterType="map" resultType="int">
		/*회원 전체 행의 갯수*/
		SELECT
			COUNT(*)
		FROM
			user_manage as u
		<where>
        	<if test="searchValue != null and searchValue !=''">
        		${searchKey} = #{searchValue};
        	</if>
        </where>
	</select> 
	
	<select id="getIncreaseCode" resultType="String" parameterType="String">
		/* 자동 숫자 증가 코드 가져오기 */
		<![CDATA[
		SELECT
			CASE
				WHEN COUNT(*) = 0
				THEN '${tableName}_code1'
			ELSE	
				CONCAT('${tableName}_code',
				MAX(CAST(SUBSTRING_INDEX(${tableName}_code,'code',-1) AS UNSIGNED))+1)
			END AS increaseCode
		FROM
			${tableName}
		]]>
	</select>
	
</mapper>