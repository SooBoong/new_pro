<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- dao 작성 -->
<!-- namespace : implememts와 같은 기능 -->
<mapper namespace="ks47team03.user.mapper.UserPointMapper">

	<resultMap type="Account" id="userAccountResultMap">
		<id column="user_bank_code" 	property="userBankCode"/>
		<result column="user_id" 					property="userId"/>
		<result column="account_user_name" 		property="accountUserName"/>		
		<result column="bank_name" 					property="bankName"/>		
		<result column="account_number" 				property="accountNumber"/>		
	</resultMap>
	
	<resultMap type="Point" id="pointResultMap">
		<id column="user_deposit_point_code" 	property="userDepositPointCode"/>
		<result column="user_id" 					property="userId"/>
		<result column="current_holding_point" 		property="currentHoldingPoint"/>		
		<result column="admin_id" 					property="adminId"/>		
		<result column="up_datetime" 				property="upDatetime"/>		
	</resultMap>
	
	<update id="modifyUserAccount" parameterType="Account">
		/* 회원 계좌 수정 */
		UPDATE
			user_bank 
		SET 
			account_user_name = #{accountUserName},
			bank_name = #{bankName},
			account_number = #{accountNumber},
			admin_id = 'adminid001',
			up_datetime = CURDATE()
		WHERE
			user_id = #{userId}
	</update>
	
	<insert id="addUserAccount" parameterType="Account">
		/* 회원 계좌 등록 */
		INSERT INTO user_bank 
		VALUES(#{userBankCode},
				#{userId},
				#{accountUserName},
				#{bankName},
				#{accountNumber},
				'adminid001',
				CURDATE());
	</insert>
	
	<select id="getUserAccount" parameterType="String" resultMap="userAccountResultMap">
		/* 특정 회원 계좌 조회 */
		SELECT
			user_bank_code,
			user_id,
			account_user_name,
			bank_name,
			account_number
		FROM
			user_bank
		WHERE
			user_id = #{sessionId}
	</select>
	
	<select id="getUserPoint" parameterType="String" resultMap="pointResultMap">
		/* 특정 회원 현재 보유 포인트 조회*/
		SELECT
			point_past_now_history_code,
			user_id,
			current_holding_point,
			admin_id,
			up_datetime
		FROM
			point_past_now_history
		WHERE
			user_id = #{userId}
		ORDER BY up_datetime DESC
		LIMIT 1;
	</select>
		
	<select id="getAllUserPoint" parameterType="map" resultMap="pointResultMap">
		/* 전체 회원 현재 보유 포인트 조회*/
		SELECT
			CAST(SUBSTRING_INDEX(user_deposit_point_code,'code',-1) AS UNSIGNED) AS num,
			user_deposit_point_code AS userDepositPointCode
			user_id,
			current_holding_point,
			admin_id,
			up_datetime
		FROM 
			user_deposit_point
		ORDER BY num
		<if test="currentFirstIndex != null and currentFirstIndex > -1">
			LIMIT #{currentFirstIndex},#{rowPerPage};
		</if>
	</select>
	
	<select id="getAllUserPointCount" parameterType="String" resultType="int">
		/* 데이터 개수 조회 */
		SELECT
			COUNT(*)
		FROM
			${tableName}
		<where>
			<if test="tableName == 'day_maximum_count'">
				day_maximum_count_code LIKE'%point%';
			</if>
		</where>
	</select>
	
	
</mapper>